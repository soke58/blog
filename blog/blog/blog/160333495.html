<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>发一个站内搜索代码</title></head><body><h1>发一个站内搜索代码</h1><div><p>基于“搜索引擎工厂”（下载地址<a href="http://down1.tech.sina.com.cn/download/down_page/1097337600/2894.shtml">http://down1.tech.sina.com.cn/download/down_page/1097337600/2894.shtml</a>）生成的ACESS数据库而打造的搜索代码，模仿百度显示结果的风格，并实现简单的过滤功能，各个功能的代码是本人从网上整和而成，并完善。本人不保证代码的规范性，安全性，仅用于学习测试使用，没什么所谓的版权，反正藏着也不用。至于“搜索引擎工厂”这个软件的注册码，网上有，自己搜。</p>
<p>&lt;html&gt;</p>
<p>&lt;head&gt;<br>&lt;meta http-equiv="Content-Type" content="text/html; charset=gb2312"&gt;<br>&lt;title&gt;MyBlog search 混子制作&lt;/title&gt;<br>&lt;script laguage="javascript"&gt; <br>&lt;!--<br>function frm_Search_onsubmit()</p>
<p>{ <br>if(frm_Search.key.value.replace(/(^\s*)|(\s*$)/g,"") == "") <br>{ <br>alert("注意：请别偷懒！"); <br>frm_Search.key.focus(); <br>return false; <br>} <br>}<br>--&gt;<br>&lt;/script&gt;<br>&lt;script LANGUAGE="javascript"&gt; <br>&lt;!-- <br>function openwin()<br>{ <br>alert("抱歉~您查询的页面地址未找到~！");<br>//写成一行 <br>} <br>--&gt; <br>&lt;/script&gt; <br>&lt;/head&gt;<br>&lt;body&gt;</p>
<p>&lt;% Dim strProvider,CNN<br>strProvider="Provider=Microsoft.Jet.OLEDB.4.0; Data Source=" &amp; Server.MapPath("IndexData.MDB") ' <br>Set CNN = Server.CreateObject("ADODB.connection") <br>CNN.Open strProvider <br>%&gt; <br>&lt;!-- 在上面的代码中，有一个自定义函数AutoKey ，该函数是实现智能搜索的核心所在。代码如下： --&gt;<br>&lt;% <br>Function AutoKey(strKey) <br>CONST lngSubKey=2 <br>Dim lngLenKey,strNew1,strNew2,i,strSubKey</p>
<p>''检测字符串的合法性，若不合法则转到出错页。出错页你可以根据需要进行设定。 <br>if InStr(strKey,"=")&lt;&gt;0 or InStr(strKey,"`")&lt;&gt;0 or InStr(strKey,"''")&lt;&gt;0 or InStr(strKey," ")&lt;&gt;0 or InStr(strKey,"　")&lt;&gt;0 or InStr(strKey,"''")&lt;&gt;0 or InStr(strKey,chr(34))&lt;&gt;0 or InStr(strKey,"\")&lt;&gt;0 or InStr(strKey,",")&lt;&gt;0 or InStr(strKey,"&lt;")&lt;&gt;0 or InStr(strKey,"&gt;")&lt;&gt;0 then <br>Response.Redirect "error.htm" <br>End If</p>
<p>lngLenKey=Len(strKey) <br>Select Case lngLenKey <br>Case 0 ''若为空串，转到出错页 <br>Response.Redirect "error.htm" <br>Case 1 ''若长度为1，则不设任何值 <br>strNew1="" <br>strNew2="" <br>Case Else ''若长度大于1，则从字符串首字符开始，循环取长度为2的子字符串作为查询条件 <br>For i=1 To lngLenKey-(lngSubKey-1) <br>strSubKey=Mid(strKey,i,lngSubKey) <br>strNew1=strNew1 &amp; " or title like '%"&amp;strSubKey&amp;"%'" <br>strNew2=strNew2 &amp; " or Description like '%"&amp;strSubKey&amp;"%'" <br>Next <br>End Select <br>''得到完整的SQL语句 <br>AutoKey="Select * from IndexData where title like '%"&amp;strKey&amp;"%' or Description like '%"&amp;strKey&amp;"%' or text like '%"&amp;strKey&amp;"%' " &amp; strNew1 &amp; strNew2 <br>End Function <br>%&gt;<br>&lt;br&gt;<br>&lt;br&gt;<br>&lt;form name="frm_Search" method="get" action="searchs.asp" onsubmit="return frm_Search_onsubmit()"&gt;<br>&lt;p align="center"&gt;<br>&lt;input type=text name=key size=42 maxlength=100 style="font-style: normal; font-variant: normal; font-weight: normal; font-size: 16px; font-family: Verdana; height: 31; width: 345; padding-top: 2px"&gt; <br>&lt;input type=submit value=站内查询 style="font-size: 14px; height: 2em; width: 5.6em" &gt;&lt;/p&gt;<br>&lt;/form&gt;<br>&lt;!--接下来，判断 ASP页所接收到的数据，并在数据库中进行搜索。 --&gt; <br>&lt;% <br>Dim S_Key,RST,StrSQL <br>S_Key = Trim(Request("key")) ''得到搜索关键字的值 <br>S_Key=Replace(S_Key,"&amp;nbsp;","")<br>S_Key=Replace(S_Key," ","")<br>S_Key=Replace(S_Key,",","")<br>S_Key=Replace(S_Key,",","")<br>S_Key=Replace(S_Key,"&lt;&gt;","")<br>S_Key=Replace(S_Key,"=","")<br>S_Key=Replace(S_Key,"&lt;","")<br>S_Key=Replace(S_Key,"&gt;","")<br>S_Key=Replace(S_Key,"。","")<br>S_Key=Replace(S_Key,"'","")<br>S_Key=Replace(S_Key,Chr("34") ,"”")''将英文引号转为中文<br>S_Key=Replace(S_Key,"CHR(32)","")''将空格换掉<br>S_Key=Replace(S_Key,"CHR(9)","")''将TAB换掉<br>S_Key=Replace(S_Key,"CHR(13)","")''将换行换掉<br>S_Key=Replace(S_Key,"CHR(10)","")''将回车换掉<br>S_Key=Replace(S_Key,"CHR(39)","")''将单引号换掉<br>S_Key=Replace(S_Key,"？","")''可以继续添加屏蔽的特殊符号<br>S_Key=LCase(S_Key)</p>
<p><br>function strlen(S_Key) ''计算输入关键词长度<br>dim p_len <br>p_len=0 <br>strlen=0 <br>if trim(S_Key)&lt;&gt;"" then <br>p_len=len(trim(S_Key)) <br>for xx=1 to p_len <br>if asc(mid(S_Key,xx,1))&lt;0 then <br>strlen=int(strlen) + 2 <br>else <br>strlen=int(strlen) + 1 <br>end if <br>next <br>end if <br>end function</p>
<p>function strvalue(S_Key,lennum) <br>dim p_num <br>dim i <br>if strlen(S_Key)&lt;=lennum then <br>strvalue=S_Key <br>else <br>p_num=0 <br>x=0 <br>do while not p_num &gt; lennum-2 <br>x=x+1 <br>if asc(mid(S_Key,x,1))&lt;0 then <br>p_num=int(p_num) + 2 <br>else <br>p_num=int(p_num) + 1 <br>end if <br>strvalue=left(trim(S_Key),x)&amp;"…" <br>loop <br>end if <br>end function</p>
<p>If strlen(S_Key)&gt;80 then<br>response.write ("&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;table width=""100%"" align='center' border=0 &gt;&lt;tr&gt;&lt;td vAlign=top align='center' rowSpan=2&gt;太长了，老大！最长40个字~&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/br&gt;")<br>else</p>
<p>If S_Key &lt;&gt;"" then <br>Set RST=Server.CreateObject("ADODB.RecordSet") <br>StrSQL=AutoKey(S_Key) ''此处使用自定义函数 AutoKey()，该函数为实现智能搜索的核心 <br>RST.Open StrSQL,CNN,3,2 ''得到搜索后的记录 <br>If RST.BOF And RST.EOF Then <br>response.write "&lt;br&gt;&lt;br&gt;&lt;br&gt;"<br>response.write ("&lt;table width=""100%"" align='center' border=0 &gt;&lt;tr&gt;&lt;td vAlign=top align='center' colSpan=2&gt;"&amp;S_Key&amp;"------ 未找到任何结果。&lt;p&gt;&lt;/td&gt;&lt;td vAlign=top align='center' rowSpan=2&gt;　&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td width=100&gt;　&lt;/td&gt;&lt;td vAlign=top align='center' width=""70%""&gt;&lt;ol&gt;&lt;li&gt;请您检查输入的文字有无错误，或换另一个关键词查询；&lt;br&gt;&lt;br&gt;&lt;/li&gt;&lt;li&gt;请查看&lt;a href=help.asp target=_blank&gt;帮助信息&lt;/a&gt;，学习使用本搜索系统；&lt;/li&gt;&lt;/ol&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/br&gt;")<br>else</p>
<p>%&gt;<br>&lt;table border="0" width="50%" height="23"&gt;<br>&lt;tr&gt;<br>&lt;td height="23" width="512"&gt;<br>&lt;font color="#339933" size="2" face="楷体_GB2312"&gt;“&lt;/font&gt;&lt;font color="#339933" size="2" face="宋体"&gt;&lt;%= S_Key %&gt;&lt;/font&gt;&lt;font color="#339933" size="2" face="楷体_GB2312"&gt;”的查询结果为 &lt;%= RST.RecordCount %&gt; 项&lt;/font&gt;&lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;/table&gt; <br>&lt;%<br>shownum=2<br>totalrecord=RST.recordcount<br>RST.pagesize=shownum<br>maxpage=RST.pagecount<br>requestpage=request.querystring("page")<br>if not IsNumeric(requestpage) or isEmpty(requestpage) and page=1 then ''判断输入的页面是否是数字<br>response.redirect "searchs.asp?page=1&amp;key="&amp;S_Key&amp;""<br>else<br>requestpage=clng(request.querystring("page"))<br>if requestpage="" or requestpage=0 then<br>&nbsp;&nbsp; requestpage=1<br>end if<br>if resquestpage&gt;maxpage then<br>&nbsp;&nbsp;&nbsp; resquestpage=maxpage<br>end if</p>
<p>if not requestpage=1 then<br>RST.move (requestpage-1)*RST.pagesize<br>end if<br>if requestpage&gt;maxpage then ''判断请求页面是否大于总页面<br>response.redirect "searchs.asp?page="&amp;maxpage&amp;"&amp;key="&amp;S_Key&amp;""<br>end if<br>end if<br>for i=1 to RST.pagesize and not RST.bof<br>%&gt;<br>&lt;div align="left"&gt;<br>&lt;table border="0" width="60%" cellspacing="1" cellpadding="0"&gt;</p>
<p>&lt;tr&gt;<br>&lt;!-- 下面代码实现关键词的简单高亮显示 --&gt; <br>&lt;% if RST("Visited")=no then%&gt;<br>&lt;hr align="left" width="100%" size="1" color="#FF9933"&gt;<br>&lt;font style="font: 12pt 宋体"&gt;&lt;a a href="#" onclick="return openwin()" &gt;&lt;%=RST("title")%&gt;&lt;font size="1" color="#FF0000" face="楷体_GB2312"&gt;该网址处于审核中...&lt;/font&gt;&lt;/a&gt;&lt;/font&gt;&lt;p&gt;<br>&lt;%else %&gt;<br>&lt;%<br>Ttitle=replace(RST("title"),S_Key,"&lt;font color=red&gt;"&amp;S_Key&amp;"&lt;/font&gt;")<br>Ttext=replace(RST("text"),S_Key,"&lt;font color=red&gt;"&amp;S_Key&amp;"&lt;/font&gt;") <br>DDescription=replace(RST("Description"),S_Key,"&lt;font color=red&gt;"&amp;S_Key&amp;"&lt;/font&gt;")<br>cdb=split(RST("links"),"||") ''分割字符窜<br>if ubound(cdb)&lt;0 then<br>%&gt;<br>&lt;hr align="left" width="100%" size="1" color="#FF9933"&gt;<br>&lt;td height="66" width="841"&gt;<br>&lt;!-- 此处判断数组是否小于0防止下标越界 --&gt;<br>&lt;%cd=split(RST("FileName"),":") ''<br>if ubound(cd)&lt;-1 then %&gt;<br>&lt;font style="font: 12pt 宋体"&gt;&lt;a a href="#" onclick="return openwin()" &gt;&lt;%response.write Ttitle%&gt;&lt;/a&gt;&lt;/font&gt;&lt;p&gt;<br>&lt;!-- 显示部分详细内容 --&gt; <br>&lt;%<br>else<br>%&gt;<br>&lt;font style="font: 12pt 宋体"&gt;&lt;a a href="&lt;%=RST("FileName")%&gt;" target="_blank" &gt;&lt;%response.write Ttitle%&gt;&lt;/a&gt;&lt;/font&gt;&lt;p&gt;<br>&lt;%<br>END IF<br>%&gt;<br>&lt;font color="#008080"&gt;&lt;font size="2" face="楷体_GB2312"&gt;关键词：&lt;/font&gt;&lt;font style="font-style:normal; font-variant:normal; font-family:隶书体" size="2" face="楷体_GB2312"&gt;&lt;%= S_Key %&gt;&amp;nbsp;&lt;%= Left(RST("keywords"),30) %&gt;&lt;/font&gt;&lt;/font&gt;&lt;p&gt;<br>&lt;font style="font: 9pt 宋体"&gt;&lt;%= Left((Ttext),300) %&gt;&lt;/font&gt;<br>&lt;font style="font: 9pt 宋体"&gt;&lt;%= Left((DDescription),300) %&gt;...&lt;/font&gt; &lt;p&gt;<br>&lt;font color="#339933"&gt;&lt;font size="2"&gt;&lt;%= RST("filename") %&gt;&lt;/font&gt; &lt;font size="2"&gt; -&lt;%= RST("size") %&gt;K &lt;%= RST("LastModified") %&gt;<br>&lt;/font&gt;&lt;/font&gt;<br>&lt;!-- 上面可用：&lt;a href="info.asp?FileID=&lt;%= RST("FileID") %&gt;" target="_blank"&gt;&lt;%= RST("filename") %&gt;&lt;/a&gt;代替哦 --&gt;&lt;/td&gt;<br>&lt;%<br>else<br>%&gt;<br>&lt;hr align="left" width="100%" size="1" color="#FF9933"&gt;<br>&lt;td height="66" width="841"&gt;<br>&lt;font style="font: 12pt 宋体"&gt;&lt;a href="&lt;%= Left((cdb(0)),300) %&gt;" target="_blank"&gt;&lt;%response.write Ttitle%&gt;&lt;/a&gt;&lt;/font&gt;&lt;p&gt;<br>&lt;!-- 显示部分详细内容 --&gt; <br>&lt;font color="#008080"&gt;&lt;font size="2" face="隶书体"&gt;关键词：&lt;/font&gt;&lt;font style="font-style:normal; font-variant:normal; font-family:隶书体" size="2"&gt;&lt;%= S_Key %&gt;&amp;nbsp;&lt;%= Left(RST("keywords"),30) %&gt;&lt;/font&gt;&lt;font size="2" face="隶书体"&gt;&lt;/font&gt;&lt;/font&gt;&lt;p&gt;<br>&lt;font style="font: 9pt 宋体"&gt;&lt;%= Left((Ttext),300) %&gt;&lt;/font&gt;<br>&lt;font style="font: 9pt 宋体"&gt;&lt;%= Left((DDescription),300) %&gt;...&lt;/font&gt; &lt;p&gt;<br>&lt;font color="#339933"&gt;&lt;font size="2"&gt; &lt;%= Left((cdb(0)),300) %&gt;&nbsp;&nbsp; -&lt;%= RST("size") %&gt;K &lt;%= RST("LastModified") %&gt;<br>&lt;/font&gt;&lt;/font&gt;<br>&lt;!-- 上面可用：&lt;a href="info.asp?FileID=&lt;%= RST("FileID") %&gt;" target="_blank"&gt;&lt;%= RST("filename") %&gt;&lt;/a&gt;代替哦 --&gt;&lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;/table&gt;<br>&lt;%END IF<br>end if<br>RST.movenext<br>if RST.eof then exit for<br>next<br>%&gt;&lt;/div&gt;<br>&lt;table border="0" width="60%" cellspacing="1" cellpadding="0" &gt;<br>&lt;hr align="left" width="100%" size="1" color="#FF9933"&gt;<br>&lt;tr&gt;&lt;td height="23" width="100%" align=center&gt;<br>&lt;%<br>end if<br>pageno=int(requestpage)<br>pagenum=maxpage<br>if pageno="" or pageno&gt;pagenum then<br>pageno=1<br>else<br>pageno=pageno<br>end if<br>'显示数量设定<br>showpagenum=10<br>'上一页显示判断<br>if pageno&gt;1 then<br>response.write " &lt;a href='searchs.asp?key="&amp;S_Key&amp;"&amp;page="&amp;pageno-1&amp;"'&gt;上一页&lt;/a&gt; "<br>'response.end()<br>end if<br>if pagenum&gt;showpagenum then<br>num_left=pageno-1<br>num_right=pagenum-pageno<br>if num_left&gt;(showpagenum/2) then<br>if num_right&lt;(showpagenum/2) then<br>&nbsp;&nbsp;&nbsp; page_left=pageno-(showpagenum-num_right)+1<br>&nbsp;&nbsp;&nbsp; page_right=pagenum<br>else<br>&nbsp;&nbsp;&nbsp; page_left=pageno-(showpagenum/2)<br>&nbsp;&nbsp;&nbsp; page_right=pageno+(showpagenum/2)<br>end if<br>else<br>&nbsp;&nbsp;&nbsp; page_left=1<br>&nbsp;&nbsp;&nbsp; page_right=pageno+(showpagenum-num_left)-1<br>end if<br>'前项输出<br>for P=page_left to pageno-1<br>&nbsp;&nbsp;&nbsp; response.write " &lt;a href='searchs.asp?key="&amp;S_Key&amp;"&amp;page="&amp;p&amp;"'&gt;["&amp;p&amp;"]&lt;/a&gt;"<br>next<br>'当前项输出<br>response.write " &lt;FONT color=red&gt;"&amp;pageno&amp;"&lt;/FONT&gt;&lt;/b&gt; "<br>'后项输出<br>for f=pageno+1 to page_right<br>&nbsp;&nbsp;&nbsp; response.write " &lt;a href='searchs.asp?key="&amp;S_Key&amp;"&amp;page="&amp;f&amp;"'&gt;["&amp;f&amp;"]&lt;/a&gt; "<br>next<br>else<br>for i=1 to pagenum<br>if i=pageno then<br>response.write " &lt;b&gt;&lt;FONT color=red&gt;"&amp;i&amp;"&lt;/FONT&gt;&lt;/b&gt; "<br>'response.end()<br>else<br>response.write " &lt;a href='searchs.asp?key="&amp;S_Key&amp;"&amp;page="&amp;i&amp;"'&gt;["&amp;i&amp;"]&lt;/a&gt; "<br>'response.end()<br>end if<br>next<br>end if<br>'最后一页判断<br>if pageno&lt;pagenum then<br>response.write " &lt;a href='searchs.asp?key="&amp;S_Key&amp;"&amp;page="&amp;pageno+1&amp;"'&gt;下一页&lt;/a&gt; "<br>'response.end()<br>end if <br>%&gt;</p>
<p>&lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;!--response.write"&nbsp;&nbsp;&nbsp; "&amp;requestpage&amp;"/"&amp;maxpage&amp;" " --&gt;<br>&lt;/table&gt;<br>&lt;hr align="left" width="60%" size="1" color="#FF9933"&gt;</p>
<p>&lt;% <br>CNN.Close <br>Set CNN=Nothing <br>%&gt;<br>&lt;%<br>end if<br>end if<br>Set RST=Nothing <br>%&gt;</p>
<p>&lt;/body&gt;<br>&lt;/html&gt;</p></div></body></html>