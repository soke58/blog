<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>vb6引用windowsmediaplayer控件制作的稍微美化的简单播放器</title></head><body><h1>vb6引用windowsmediaplayer控件制作的稍微美化的简单播放器</h1><div><p>这个播放器几乎花了我一天半时间去弄，几乎每个细节都会出问题。新手就悲剧，其中过程发现，VB强大的同时也发现了不少局限性。</p><p>这个播放器，还有许多不足之处，比如关联播放的时候，歌曲列表无法准确定位，不支持拖拽播放等，也许是自己偷懒用filelist作菜单的原因。由于还不会搞进度条，于是就干脆直接显示控件窗体来代替，头都大了，不搞了，头疼，代码如下（仅供和我一样还是菜菜的新手看）：</p><p><span style="color: #ff0000;">1.窗体FORM1代码,记得在该窗体点工具--菜单编辑器，设计一个名为menu的菜单，并设置为不可见，以便在托盘右键调用</span></p><p></p><p>Option Explicit</p><p>Dim URL As String '播放器播放文件的路径</p><p>Dim PH As String '歌曲文件夹路径</p><p>Dim i As Integer 'filelist指针值</p><p>Dim nowpath As String '打开控件CommonDialog1后获取的新路径</p><p>Dim nowname As String '获取用户关联程序后，所双击打开文件的名称及文件类型</p><p>Dim a, b As Integer '用来存储用户改变菜单歌曲选择时的listindex值</p><p>Dim f As Integer</p><p></p><p>Private lpTrayIconData As NOTIFYICONDATA</p><p>Private Declare Function SendMessage Lib &quot;user32&quot; Alias &quot;SendMessageA&quot; _</p><p>&nbsp; &nbsp; (ByVal hWnd As Long, ByVal wMsg As Long, ByVal wParam As Long, lParam As Any) As Long</p><p>Private Declare Function ReleaseCapture Lib &quot;user32&quot; () As Long</p><p>Private Const HTCAPTION = 2</p><p>Private Const WM_NCLBUTTONDOWN = &amp;HA1</p><p>Private Sub back_Click(Index As Integer)</p><p>PH = File1.Path '获取filelist文件的文件夹目录</p><p>If File1.ListIndex &gt;= 0 Then</p><p>&nbsp; File1.ListIndex = File1.ListIndex - 1</p><p>&nbsp; WindowsMediaPlayer1.URL = PH &amp; &quot;\&quot; &amp; File1.List(File1.ListIndex) '组合成具体文件绝对路径</p><p>&nbsp; Text1.Text = &quot;&quot;</p><p>&nbsp; Text1.Text = Replace(File1.FileName, &quot;.mp3&quot;, &quot;&quot;)</p><p>&nbsp; Text1.Text = Text1.Text + Space(27 - Len(Text1.Text))</p><p>&nbsp; WindowsMediaPlayer1.Controls.play '开始播放</p><p>End If</p><p>End Sub</p><p>Private Sub exit_Click(Index As Integer)</p><p>Unload Me</p><p>End Sub</p><p>Private Sub File1_DblClick()</p><p>&nbsp; Label2.Caption = &quot;暂停&quot;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;i = File1.ListIndex '获取filelist指针位置</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PH = File1.Path '获取filelist文件的文件夹目录</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '**************</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WindowsMediaPlayer1.URL = PH &amp; &quot;\&quot; &amp; File1.List(i) '组合成具体文件绝对路径</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Text1.Text = &quot;&quot;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Text1.Text = Replace(File1.FileName, &quot;.mp3&quot;, &quot;&quot;)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Text1.Text = Text1.Text + Space(27 - Len(Text1.Text))</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WindowsMediaPlayer1.Controls.play '开始播放</p><p>End Sub</p><p>Private Sub File1_LostFocus()</p><p>File1.Visible = False</p><p>End Sub</p><p>Private Sub File1_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)</p><p>&nbsp;b = File1.ListIndex</p><p>&nbsp;If File1.ListIndex = a Then</p><p>&nbsp; Label2.Caption = &quot;暂停&quot;</p><p>&nbsp;Else</p><p>&nbsp;Label2.Caption = &quot;播放&quot;</p><p>&nbsp;End If</p><p>&nbsp;End Sub</p><p>Private Sub File1_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)</p><p>File1.ToolTipText = File1.List(File1.TopIndex + Int(Y / Form1.TextHeight(&quot;Xyz123&quot;)))</p><p>&nbsp;End Sub</p><p></p><p>Private Sub Form_Click()</p><p>File1.Visible = False</p><p>End Sub</p><p></p><p>Private Sub Form_Load()</p><p>On Error Resume Next</p><p></p><p>With lpTrayIconData</p><p>&nbsp; &nbsp; &nbsp; &nbsp; .cbSize = Len(lpTrayIconData)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; .hIcon = Me.Icon.Handle</p><p>&nbsp; &nbsp; &nbsp; &nbsp; .hWnd = Me.hWnd</p><p>&nbsp; &nbsp; &nbsp; &nbsp; .szTip = &quot;酷猫音乐&quot; &amp; vbNullChar</p><p>&nbsp; &nbsp; &nbsp; &nbsp; .uFlags = NIF_MESSAGE Or NIF_ICON Or NIF_TIP</p><p>&nbsp; &nbsp; &nbsp; &nbsp; .uCallbackMessage = WM_TRAYICON</p><p>&nbsp; &nbsp; &nbsp; &nbsp; .uID = 0</p><p>&nbsp;End With</p><p>&nbsp; &nbsp; Shell_NotifyIcon NIM_ADD, lpTrayIconData</p><p>&nbsp; &nbsp; pWndProc = SetWindowLong(Me.hWnd, GWL_WNDPROC, AddressOf WndProc)</p><p>&nbsp; &nbsp;'***********下面这段代码限制只能运行一个该实例程序</p><p>If App.PrevInstance Then</p><p>&nbsp; End</p><p>End If</p><p>&nbsp;Image1.Left = ScaleLeft</p><p>&nbsp;Image1.Top = ScaleTop</p><p>'***********上面这段代码限制只能运行一个该实例程序</p><p>Form1.Caption = &quot;酷猫音乐&quot;</p><p>Dim ss As String &nbsp; &nbsp;'定义一个字符变量</p><p>If Command() &lt;&gt; &quot;&quot; Then</p><p>ss = Command() &nbsp; &nbsp; '这是当你设置你这个播放器作为默认播放器时，点击MP3文件时，加载的文件路径和文件名</p><p>ss = Mid(ss, 2, Len(ss) - 2) '去掉字符串中两头的英文引号</p><p>WindowsMediaPlayer1.URL = ss</p><p>WindowsMediaPlayer1.Controls.play '开始播放</p><p>nowname = Right(ss, Len(ss) - InStrRev(ss, &quot;\&quot;)) '通过获取SS字符串的总长度减去 InStrRev函数获取的值来，截取最后一个&quot;\&quot;符号右边的字符串，即用户所双击打开文件的名称及文件类型</p><p>Text1.Text = Replace(nowname, &quot;.mp3&quot;, &quot;&quot;)</p><p>&nbsp; &nbsp; If WindowsMediaPlayer1.playState = wmppsStopped Then '如果唱完这首歌，则开始循环读取下一个歌曲</p><p>&nbsp; &nbsp; &nbsp; &nbsp;File1.ListIndex = File1.ListIndex + 1</p><p>&nbsp; &nbsp; End If</p><p>End If</p><p>End Sub</p><p>Private Sub Form_Resize()</p><p>'***********下面这段代码将Image1控件里面的图片设置铺满整个窗体</p><p>Image1.Width = ScaleWidth</p><p>Image1.Height = ScaleHeight</p><p>End Sub</p><p>Private Sub Form_Unload(Cancel As Integer)</p><p>&nbsp; &nbsp;Shell_NotifyIcon NIM_DELETE, lpTrayIconData</p><p>&nbsp; &nbsp;SetWindowLong Me.hWnd, GWL_WNDPROC, pWndProc</p><p>End Sub</p><p>Private Sub Image1_Click()</p><p>File1.Visible = False</p><p>End Sub</p><p>Private Sub Image1_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)</p><p>&nbsp; &nbsp; ReleaseCapture &nbsp;'释放鼠标捕获</p><p>&nbsp; &nbsp; SendMessage hWnd, WM_NCLBUTTONDOWN, HTCAPTION, ByVal 0&amp;</p><p>End Sub</p><p>Private Sub Image2_Click()</p><p>File1.Visible = False</p><p>End Sub</p><p>&nbsp;</p><p>Private Sub Label2_Click()</p><p>On Error Resume Next</p><p>File1.Visible = True</p><p>a = File1.ListIndex</p><p>If Label2.Caption = &quot;播放&quot; And File1.ListCount &lt;&gt; 0 Then</p><p>&nbsp; &nbsp; &nbsp; &nbsp;If WindowsMediaPlayer1.playState = wmppsPaused Then</p><p>&nbsp; &nbsp; &nbsp; &nbsp;If File1.List(a) = File1.List(b) Then</p><p>&nbsp; &nbsp; &nbsp; &nbsp; Label2.Caption = &quot;暂停&quot;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WindowsMediaPlayer1.Controls.play '暂停</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Else</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Label2.Caption = &quot;暂停&quot;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;i = File1.ListIndex '获取filelist指针位置</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PH = File1.Path '获取filelist文件的文件夹目录</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '**************</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WindowsMediaPlayer1.URL = PH &amp; &quot;\&quot; &amp; File1.List(i) '组合成具体文件绝对路径</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Text1.Text = &quot;&quot;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Text1.Text = Replace(File1.FileName, &quot;.mp3&quot;, &quot;&quot;)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Text1.Text = Text1.Text + Space(27 - Len(Text1.Text))</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WindowsMediaPlayer1.Controls.play '开始播放</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;End If</p><p>&nbsp; &nbsp; &nbsp; &nbsp;Else</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Label2.Caption = &quot;暂停&quot;</p><p>&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;i = File1.ListIndex '获取filelist指针位置</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PH = File1.Path '获取filelist文件的文件夹目录</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '**************</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WindowsMediaPlayer1.URL = PH &amp; &quot;\&quot; &amp; File1.List(i) '组合成具体文件绝对路径</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Text1.Text = &quot;&quot;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Text1.Text = Replace(File1.FileName, &quot;.mp3&quot;, &quot;&quot;)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Text1.Text = Text1.Text + Space(27 - Len(Text1.Text))</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WindowsMediaPlayer1.Controls.play '开始播放</p><p>&nbsp; &nbsp; &nbsp; &nbsp;End If</p><p></p><p>ElseIf Label2.Caption = &quot;暂停&quot; Then</p><p>&nbsp; &nbsp;WindowsMediaPlayer1.Controls.Pause '暂停</p><p>&nbsp; &nbsp;Label2.Caption = &quot;播放&quot;</p><p>End If</p><p>&nbsp;</p><p>End Sub</p><p></p><p>Private Sub Label4_Click()</p><p>File1.Visible = True</p><p>WindowsMediaPlayer1.Controls.stop '停止</p><p>End Sub</p><p></p><p>Private Sub Label5_Click()</p><p>On Error Resume Next</p><p>File1.Visible = True</p><p>If File1.ListCount &lt;&gt; 0 Then</p><p></p><p>Label2.Caption = &quot;暂停&quot;</p><p>&nbsp;End If</p><p>PH = File1.Path '获取filelist文件的文件夹目录</p><p>If File1.ListIndex &gt;= 0 Then</p><p>&nbsp; File1.ListIndex = File1.ListIndex - 1</p><p>&nbsp; WindowsMediaPlayer1.URL = PH &amp; &quot;\&quot; &amp; File1.List(File1.ListIndex) '组合成具体文件绝对路径</p><p>&nbsp; Text1.Text = &quot;&quot;</p><p>&nbsp; Text1.Text = Replace(File1.FileName, &quot;.mp3&quot;, &quot;&quot;)</p><p>&nbsp; Text1.Text = Text1.Text + Space(27 - Len(Text1.Text))</p><p>&nbsp; WindowsMediaPlayer1.Controls.play '开始播放</p><p>&nbsp;End If</p><p>&nbsp;a = File1.ListIndex</p><p>End Sub</p><p>Private Sub Label6_Click()</p><p>On Error Resume Next</p><p>File1.Visible = True</p><p>&nbsp; If File1.ListCount &lt;&gt; 0 Then</p><p>&nbsp;</p><p>&nbsp; Label2.Caption = &quot;暂停&quot;</p><p>&nbsp;End If</p><p>&nbsp;</p><p>PH = File1.Path '获取filelist文件的文件夹目录</p><p>If File1.ListIndex &lt; File1.ListCount - 1 Then</p><p>&nbsp;</p><p>&nbsp; File1.ListIndex = File1.ListIndex + 1</p><p>&nbsp; WindowsMediaPlayer1.URL = PH &amp; &quot;\&quot; &amp; File1.List(File1.ListIndex) '组合成具体文件绝对路径</p><p>&nbsp; Text1.Text = &quot;&quot;</p><p>&nbsp; Text1.Text = Replace(File1.FileName, &quot;.mp3&quot;, &quot;&quot;)</p><p>&nbsp; Text1.Text = Text1.Text + Space(27 - Len(Text1.Text))</p><p>&nbsp; WindowsMediaPlayer1.Controls.play '开始播放</p><p>&nbsp;&nbsp;End If</p><p>&nbsp;a = File1.ListIndex</p><p>End Sub</p><p>Private Sub Label7_Click()</p><p>File1.Visible = True</p><p>&nbsp; On Error GoTo errhandler</p><p>Dim s</p><p>With CommonDialog1</p><p>&nbsp;.CancelError = True</p><p>&nbsp;.Flags = cdlOFNAllowMultiselect Or cdlOFNExplorer</p><p>&nbsp;.InitDir = App.Path '予设存档路径</p><p>&nbsp;.Filter = &quot;音乐文件(*.mp3)|*.mp3&quot;</p><p>&nbsp;.ShowOpen</p><p>End With</p><p>&nbsp;s = Split(CommonDialog1.FileName, Chr(0)) '此处对用户所选择的文件分入数组</p><p>If UBound(s) &lt; 2 Then '此处判断用户所选择的文件小于两个，也就是选一个的时候娶该文件所处的文件夹路径，我写小于1的时候居然下面的代码执行不来，郁闷</p><p>&nbsp; nowpath = Left(CommonDialog1.FileName, InStrRev(CommonDialog1.FileName, &quot;\&quot;) - 1) '这就是打开控件CommonDialog1后获取的文件夹目录，已经过滤掉文件名</p><p>&nbsp; File1.Path = nowpath</p><p>Else '此处判断用户所选择的文件大于两个，则直接等于CommonDialog1.FileName，因为filelist能自己提取那些文件名</p><p>&nbsp; File1.Path = CommonDialog1.FileName 'FILELIST列表文件更新成CommonDialog1刚选择的音乐文件夹</p><p>End If</p><p>errhandler:</p><p>&nbsp;If Err = 32755 Then Exit Sub '选择了取消</p><p>End Sub</p><p>Private Sub next_Click(Index As Integer)</p><p>PH = File1.Path '获取filelist文件的文件夹目录</p><p>If File1.ListIndex &lt; File1.ListCount - 1 Then</p><p>File1.ListIndex = File1.ListIndex + 1</p><p>WindowsMediaPlayer1.URL = PH &amp; &quot;\&quot; &amp; File1.List(File1.ListIndex) '组合成具体文件绝对路径</p><p>Text1.Text = &quot;&quot;</p><p>Text1.Text = Replace(File1.FileName, &quot;.mp3&quot;, &quot;&quot;)</p><p>Text1.Text = Text1.Text + Space(27 - Len(Text1.Text))</p><p>WindowsMediaPlayer1.Controls.play '开始播放</p><p>End If</p><p>End Sub</p><p>Private Sub play_Click(Index As Integer)</p><p>On Error Resume Next</p><p>Label2.Caption = &quot;暂停&quot;</p><p>WindowsMediaPlayer1.Controls.play '开始播放</p><p>End Sub</p><p>Private Sub puse_Click(Index As Integer)</p><p>Label2.Caption = &quot;播放&quot;</p><p>WindowsMediaPlayer1.Controls.Pause '暂停</p><p>End Sub</p><p>Private Sub stop_Click(Index As Integer)</p><p>WindowsMediaPlayer1.Controls.stop '停止</p><p>End Sub</p><p>Private Sub Timer1_Timer()</p><p>On Error Resume Next</p><p>'**************下面代码实现依次自动读取列表filelist文件，是前面文章的代码，实现自动顺序播放音乐文件的功能</p><p>&nbsp;If File1.ListIndex = File1.ListCount - 1 Then '如果执行完退出</p><p>Timer1.Enabled = False</p><p>&nbsp; &nbsp;Else</p><p></p><p></p><p></p><p>&nbsp;If WindowsMediaPlayer1.playState = wmppsStopped Then '如果唱完一首歌，则开始循环读取下一个歌曲</p><p></p><p>i = File1.ListIndex</p><p></p><p>&nbsp;PH = File1.Path</p><p></p><p>&nbsp;'**************</p><p>For f = File1.ListCount - 1 To 0 Step -1</p><p>&nbsp; &nbsp; &nbsp;If File1.Selected(f) &lt;&gt; 0 Then '判断如果FILELIST选择值为TURE时，防止为零时始终选第一个文件</p><p>&nbsp; &nbsp; &nbsp;f = f + 1</p><p>&nbsp; &nbsp; File1.Selected(f) = f</p><p></p><p>&nbsp; &nbsp;End If</p><p>&nbsp; &nbsp; Next</p><p>&nbsp; &nbsp; WindowsMediaPlayer1.URL = PH &amp; &quot;\&quot; &amp; File1.List(i + 1) '播放器也选择下一个文件，开始播放</p><p>Text1.Text = &quot;&quot;</p><p>Text1.Text = Replace(File1.FileName, &quot;.mp3&quot;, &quot;&quot;)</p><p>Text1.Text = Text1.Text + Space(27 - Len(Text1.Text))</p><p>End If</p><p>End If</p><p>End Sub</p><p>Private Sub Timer2_Timer()</p><p></p><p>If Text1.Text &lt;&gt; &quot;&quot; Then</p><p>Text1.Text = Right(Text1.Text, Len(Text1.Text) - 1) + Left(Text1.Text, 1) '向左移动</p><p>'Text1.Text = Right(Text1.Text, 1) + Left(Text1.Text, Len(Text1.Text) - 1) &nbsp; '向右移动</p><p>End If</p><p>End Sub</p><p></p><p>Private Sub WindowsMediaPlayer1_Click(ByVal nButton As Integer, ByVal nShiftState As Integer, ByVal fX As Long, ByVal fY As Long)</p><p>File1.Visible = False</p><p>End Sub</p><p><span style="color: #ff0000;">2.模块Module1代码（工具---添加模块，粘贴下列代码）：</span></p><p></p><p>Option Explicit</p><p>&nbsp;</p><p>Public Declare Function Shell_NotifyIcon Lib &quot;shell32.dll&quot; Alias &quot;Shell_NotifyIconA&quot; (ByVal dwMessage As Long, lpData As NOTIFYICONDATA) As Long</p><p>&nbsp;</p><p>Public Const NIM_ADD = &amp;H0</p><p>Public Const NIM_DELETE = &amp;H2</p><p>&nbsp;</p><p>Public Const NIF_ICON = &amp;H2</p><p>Public Const NIF_MESSAGE = &amp;H1</p><p>Public Const NIF_TIP = &amp;H4</p><p>'download by http://www.codefans.net</p><p>&nbsp;</p><p>Public Type NOTIFYICONDATA</p><p>&nbsp; &nbsp; &nbsp; &nbsp; cbSize As Long</p><p>&nbsp; &nbsp; &nbsp; &nbsp; hWnd As Long</p><p>&nbsp; &nbsp; &nbsp; &nbsp; uID As Long</p><p>&nbsp; &nbsp; &nbsp; &nbsp; uFlags As Long</p><p>&nbsp; &nbsp; &nbsp; &nbsp; uCallbackMessage As Long</p><p>&nbsp; &nbsp; &nbsp; &nbsp; hIcon As Long</p><p>&nbsp; &nbsp; &nbsp; &nbsp; szTip As String * 64</p><p>End Type</p><p>&nbsp;</p><p>&nbsp;</p><p>Public Declare Function SetWindowLong Lib &quot;user32&quot; Alias &quot;SetWindowLongA&quot; (ByVal hWnd As Long, ByVal nIndex As Long, ByVal dwNewLong As Long) As Long</p><p>Public Declare Function CallWindowProc Lib &quot;user32&quot; Alias &quot;CallWindowProcA&quot; (ByVal lpPrevWndFunc As Long, ByVal hWnd As Long, ByVal Msg As Long, ByVal wParam As Long, ByVal lParam As Long) As Long</p><p>&nbsp;</p><p>Public Const GWL_WNDPROC = (-4)</p><p>&nbsp;</p><p>Public Const WM_USER = &amp;H400</p><p>Public Const WM_TRAYICON = WM_USER + 123 '托盘消息</p><p>&nbsp;</p><p>Public Const WM_RBUTTONDOWN = &amp;H204</p><p>Public Const WM_RBUTTONUP = &amp;H205</p><p>&nbsp;</p><p>Public Declare Function SetForegroundWindow Lib &quot;user32&quot; (ByVal hWnd As Long) As Long</p><p>&nbsp;</p><p>'===========================================</p><p>&nbsp;</p><p>Public pWndProc As Long</p><p>&nbsp;</p><p>Public Function WndProc(ByVal hWnd As Long, ByVal Msg As Long, ByVal wParam As Long, ByVal lParam As Long) As Long</p><p>&nbsp; &nbsp; If Msg = WM_TRAYICON Then</p><p>&nbsp; &nbsp; &nbsp; &nbsp; Select Case lParam</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Case WM_RBUTTONDOWN</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SetForegroundWindow hWnd '关键的一步</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Case WM_RBUTTONUP</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Form1.PopupMenu Form1.Menu</p><p>&nbsp; &nbsp; &nbsp; &nbsp; End Select</p><p>&nbsp; &nbsp; End If</p><p>&nbsp; &nbsp;&nbsp;</p><p>&nbsp; &nbsp; WndProc = CallWindowProc(pWndProc, hWnd, Msg, wParam, lParam)</p><p>End Function</p><p></p><p></p><p>&nbsp;截图</p><p><span><img src="http://hiphotos.baidu.com/super58/pic/item/fba19f09b3de9c82a206b2c66c81800a18d84315.jpg" small="0" /></span></p><p>源码下载：<a href="http://3gqq.ys168.com" target="_blank">http://3gqq.ys168.com<br /></a></p><p></p></div></body></html>