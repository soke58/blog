<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>终于解决了我头疼的问题，自己做的一个VB程序，实现自动读取filelist文件并修改源码部分内容</title></head><body><h1>终于解决了我头疼的问题，自己做的一个VB程序，实现自动读取filelist文件并修改源码部分内容</h1><div><p>原来有6000多个HTM文件，其HTML原码TITLE标签内容和文本内容不相称，于是自己想提取文本内容作为该文件命名，为了方便阅读查询。</p><p>然而手工一个一个修改，工作量非常大。经过自己分析，发现提取第一个FONT标签的内容符合我的要求。于是着手做一个专门处理这批文档的程序，网上查询相关功能的实现源码，碍于自己是VB门外汉，甚至连做计算器都很难的新手来说，研究这个似乎很困难，确实很悲剧。在百度提问，得到的答案也不行。最后跑遍各大论坛，看遍各种回复。才做成功了。这个软件只需要我点击开始按钮，就可以自动一直执行替换下去，直到替换完成为止，一秒换一个，6000个就要换6000秒，我不敢设置时间太短，避免出错。效率虽然不怎么高，但是也给自己省了许多事情。</p><p>其界面如下图</p><p><span><img src="http://hiphotos.baidu.com/super58/pic/item/99e674292df5e0fefe94c7495c6034a85cdf72e7.jpg" small="0" /></span></p><p>接下来给同是新手的朋友一点我自己参照网络部分代码搞出来的关键代码：</p><p></p><p><span style="color: #ff0000;">Private Sub Timer1_Timer() '用时间控制实现读取列表filelist文件</span></p><p><span style="color: #ff0000;">&nbsp;On Error Resume Next</span></p><p><span style="color: #ff0000;">If Command1.Caption = &quot;点击开始&quot; Then '如果没点击按钮则时间控件未触发</span></p><p><span style="color: #ff0000;">&nbsp;Timer1.Enabled = False</span></p><p><span style="color: #ff0000;">Else</span></p><p><span style="color: #ff0000;">'**************下面代码实现依次自动读取列表filelist文件</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp;Dim f As Integer</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp;If File1.ListIndex = File1.ListCount - 1 Then '如果执行完退出</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp;Timer1.Enabled = False</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp;Else</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;For f = File1.ListCount - 1 To 0 Step -1</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;If File1.Selected(f) &lt;&gt; 0 Then '判断如果FILELIST选择值为TURE时，防止为零时始终选第一个文件</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;File1.Selected(f) = File1.Selected(f) + 1 '不为零时递加选择下一个文件</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;Else</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;File1.Selected(f) = File1.Selected(f - 1) &nbsp; '选择下一个文件</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;End If</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp;Label1.Caption = &quot;共&quot; &amp; File1.ListCount &amp; &quot;个文件,&quot; &amp; &quot;当前执行第&quot; &amp; File1.ListIndex &amp; &quot;个文件&quot; '这里显示当前操作的文件序号</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp;Next</span></p><p><span style="color: #ff0000;">'**************下面这段代码提取当前文件的名称及路径</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;picno = File1.ListIndex</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;File1.Selected(picno) = True</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;If Right(Trim(Dir1.Path), 1) = &quot;\&quot; Then</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; &nbsp;picname = Dir1.Path &amp; File1.List(picno)</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;Else</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; &nbsp;picname = Dir1.Path &amp; &quot;\&quot; &amp; File1.List(picno) '这里PICNAME是所选的文件具体路径</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;End If</span></p><p><span style="color: #ff0000;">&nbsp;'**************</span></p><p><span style="color: #ff0000;"></span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;URL = picname '引用文件路径，给浏览器WebBrowser1打开</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp;If LCase(Right(File1.filename, 4)) = &quot;.htm&quot; Then '这里判断是所选的文件格式，如果不是HTM格式则不用浏览器打开</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;WebBrowser1.Navigate2 URL</span></p><p><span style="color: #ff0000;">'**************下面这段代码顺便生成新的文件，杀毒软件会报毒</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; Dim lngFreeFile As Long</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; lngFreeFile = FreeFile &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '取得未使用的文件号。</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; If S = &quot;&quot; Then</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; Open App.Path &amp; &quot;\data\&quot; &amp; File1.filename &amp; &quot;.htm&quot; For Output As #lngFreeFile &nbsp;'创建文件名。</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; Else</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; Open App.Path &amp; &quot;\data\&quot; &amp; Text3.Text &amp; &quot;.htm&quot; For Output As #lngFreeFile &nbsp;'创建文件名。</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; End If</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; Print #lngFreeFile, Text4.Text &nbsp; '输出文本至文件中。</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; Close #lngFreeFile &nbsp;'关闭文件。</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; S = &quot;&quot;</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; End If</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp;End If</span></p><p><span style="color: #ff0000;">End If</span></p><p><span style="color: #ff0000;">End Sub</span></p><p><span style="color: #000000;">上面代码当然不可能在VB6里面直接套用，因为很多变量我都在通用模块那定义的。看懂的就改改，关键是那个自动读取filelist列表的文件代码，是自己胡乱File1.Selected(f) = File1.Selected(f) + 1修改为File1.Selected(f - 1)&nbsp;之后，居然实现的功能，本来改成f - 2，发现跳着选，后来就改成1。</span></p><p></p><p></p></div></body></html>