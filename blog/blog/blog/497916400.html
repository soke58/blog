<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>用VB打造自己的MP3播放器方法二</title></head><body><h1>用VB打造自己的MP3播放器方法二</h1><div><p>按照前面的方法，对音乐解码支持不怎么好，而且还有注册码限制，那么现在最好的控件就应该是调用微软的系统自带的WindowsMediaPlayer控件了。具体方法如下经过本人四五小时的不停测试，做成一个比较好用的播放器，还差美观何其他的一些具体对象参数。</p><p>具体控件如下图所示，至于命名都是默认：</p><p><span><img src="http://hiphotos.baidu.com/super58/pic/item/324c87ea15ce36d35907a1793af33a87e850b175.jpg" small="0" /></span></p><p>使用的控件有WindowsMediaPlayer1，Filelist，CommonDialog，timer和4个Command1,Command2,Command3,Command4具体代码如下：</p><p></p><p><span style="color: #ff0000;">Option Explicit</span></p><p><span style="color: #ff0000;">Dim URL As String '播放器播放文件的路径</span></p><p><span style="color: #ff0000;">Dim PH As String '歌曲文件夹路径</span></p><p><span style="color: #ff0000;">Dim i As Integer 'filelist指针值</span></p><p><span style="color: #ff0000;">Dim nowpath As String '打开控件CommonDialog1后获取的新路径</span></p><p><span style="color: #ff0000;">Private Sub Command1_Click()</span></p><p><span style="color: #ff0000;">i = File1.ListIndex '获取filelist指针位置</span></p><p><span style="color: #ff0000;">PH = File1.Path '获取filelist文件的文件夹目录</span></p><p><span style="color: #ff0000;">&nbsp;'**************</span></p><p><span style="color: #ff0000;">WindowsMediaPlayer1.URL = PH &amp; &quot;\&quot; &amp; File1.list(i) '组合成具体文件绝对路径</span></p><p><span style="color: #ff0000;">WindowsMediaPlayer1.Controls.Play '开始播放</span></p><p><span style="color: #ff0000;">End Sub</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">Private Sub Command2_Click()</span></p><p><span style="color: #ff0000;">WindowsMediaPlayer1.Controls.Pause '暂停</span></p><p><span style="color: #ff0000;">End Sub</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">Private Sub Command3_Click()</span></p><p><span style="color: #ff0000;">WindowsMediaPlayer1.Controls.Stop '停止</span></p><p><span style="color: #ff0000;">End Sub</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">Private Sub Command4_Click()</span></p><p><span style="color: #ff0000;">&nbsp; On Error GoTo errhandler</span></p><p><span style="color: #ff0000;">Dim s</span></p><p><span style="color: #ff0000;">&nbsp;With CommonDialog1</span></p><p><span style="color: #ff0000;">&nbsp;.CancelError = True</span></p><p><span style="color: #ff0000;">&nbsp;.Flags = cdlOFNAllowMultiselect Or cdlOFNExplorer</span></p><p><span style="color: #ff0000;">&nbsp;.InitDir = App.Path '予设存档路径</span></p><p><span style="color: #ff0000;">&nbsp;.Filter = &quot;文档文件(*.mp3)|*.mp3&quot;</span></p><p><span style="color: #ff0000;">&nbsp;.ShowOpen</span></p><p><span style="color: #ff0000;">End With</span></p><p><span style="color: #ff0000;">&nbsp;s = Split(CommonDialog1.FileName, Chr(0)) '此处对用户所选择的文件分入数组</span></p><p><span style="color: #ff0000;">&nbsp;If UBound(s) &lt; 2 Then '此处判断用户所选择的文件小于两个，也就是选一个的时候娶该文件所处的文件夹路径，我写小于1的时候居然下面的代码执行不来，郁闷</span></p><p><span style="color: #ff0000;">&nbsp;nowpath = Left(CommonDialog1.FileName, InStrRev(CommonDialog1.FileName, &quot;\&quot;) - 1) '这就是打开控件CommonDialog1后获取的文件夹目录，已经过滤掉文件名</span></p><p><span style="color: #ff0000;">File1.Path = nowpath</span></p><p><span style="color: #ff0000;">&nbsp;Else '此处判断用户所选择的文件大于两个，则直接等于CommonDialog1.FileName，因为filelist能自己提取那些文件名</span></p><p><span style="color: #ff0000;">File1.Path = CommonDialog1.FileName 'FILELIST列表文件更新成CommonDialog1刚选择的音乐文件夹</span></p><p><span style="color: #ff0000;">End If</span></p><p><span style="color: #ff0000;">errhandler:</span></p><p><span style="color: #ff0000;">&nbsp;If Err = 32755 Then Exit Sub '选择了取消</span></p><p><span style="color: #ff0000;">&nbsp;End Sub</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">Private Sub Form_Load()</span></p><p><span style="color: #ff0000;">&nbsp;Form1.Caption = &quot;自制音乐播放器器&quot;</span></p><p><span style="color: #ff0000;">‘******************下面这段实现文件关联，当你将你这个播放器作为默认播放器时，实现关联播放</span></p><p></p><p><p>Dim ss As String &nbsp; &nbsp;'定义一个字符变量</p><p>If Command() &lt;&gt; &quot;&quot; Then</p><p>ss = Command() &nbsp; &nbsp; '这是当你设置你这个播放器作为默认播放器时，点击MP3文件时，加载的文件路径和文件名</p><p>ss = Mid(ss, 2, Len(ss) - 2) '去掉字符串中两头的英文引号</p><p>WindowsMediaPlayer1.URL = ss</p><p>WindowsMediaPlayer1.Controls.play '开始播放</p><p>End If</p></p><p></p><p><span style="color: #ff0000;">End Sub</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">Private Sub Timer1_Timer()</span></p><p><span style="color: #ff0000;">On Error Resume Next</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">'**************下面代码实现依次自动读取列表filelist文件，是前面文章的代码，实现自动顺序播放音乐文件的功能</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">&nbsp; &nbsp;Dim f As Integer</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">&nbsp; &nbsp;If File1.ListIndex = File1.ListCount - 1 Then '如果执行完退出</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">&nbsp; &nbsp;Timer1.Enabled = False</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp;Else</span></p><p><span style="color: #ff0000;">&nbsp;If WindowsMediaPlayer1.playState = wmppsStopped Then '如果唱完一首歌，则开始循环读取下一个歌曲</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp;&nbsp;</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;i = File1.ListIndex</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PH = File1.Path</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'**************</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; For f = File1.ListCount - 1 To 0 Step -1</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;If File1.Selected(f) &lt;&gt; 0 Then '判断如果FILELIST选择值为TURE时，防止为零时始终选第一个文件</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;File1.Selected(f) = File1.Selected(f) + 1 '不为零时递加选择下一个文件</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;Else</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;File1.Selected(f) = File1.Selected(f - 1) &nbsp; '选择下一个文件</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">&nbsp; &nbsp; &nbsp;End If</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp; Next</span></p><p><span style="color: #ff0000;">&nbsp; &nbsp;&nbsp;</span></p><p><span style="color: #ff0000;">WindowsMediaPlayer1.URL = PH &amp; &quot;\&quot; &amp; File1.list(i + 1) '播放器也选择下一个文件，开始播放</span></p><p>&nbsp;</p><p><span style="color: #ff0000;">End If</span></p><p><span style="color: #ff0000;">End If</span></p><p><span style="color: #ff0000;">End Sub</span></p><p>【说明】大家可以选择WindowsMediaPlayer1属性visible值为FALSE隐藏该控件，然后调用其具体参数属性来控制播放时间，进度条，加以美观等，具体本人还没时间琢磨，姑且就直接设置可见好了。还有一个要提醒的是这里使用的是filelist来显示歌曲列表，最好在filelist属性窗口的Pattern选项值上写上【<span style="color: #ff0000;">*.mp3</span>】，不包括括号。加以过滤其他文件的显示。还有timer控件的interval的值设为200，反正比一首歌的时间短就可以了。</p><div>源码下载地址：<a href="http://3gqq.ys168.com" target="_blank">http://3gqq.ys168.com</a></div><p></p><p></p></div></body></html>